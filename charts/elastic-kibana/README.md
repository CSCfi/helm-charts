# Elasticsearch and Kibana Helm Chart

> [!IMPORTANT]  
> Starting on 29 September 2025, Bitnami will be changing its policy regarding its catalog. Read more [here](https://github.com/bitnami/containers/issues/83267)  
> - Current images will be moved to the [Bitnami Legacy Repository](https://hub.docker.com/u/bitnamilegacy) and will no longer be updated.  
> - Some images will still be available in the [Bitnami Secure Images](https://hub.docker.com/u/bitnamisecure) but only with the `latest` tag.  
> - To continue receiving images with the latest updates and access to different tags, you need to subscribe to the full version of Bitnami Secure Images: https://www.arrow.com/globalecs/uk/products/bitnami-secure-images/  
> - Some of our Helm Charts used `Bitnami` images. Our Helm Charts are now intended for testing/development purposes because they use `bitnamilegacy` and/or `bitnamisecure` docker repositories.  
> - However, the Bitnami project continues to make its source code available at [bitnami/containers](https://github.com/bitnami/containers) under the Apache 2 license. You can build the image and then push it to your CSC project. You can find more information on how to push images [here](https://docs.csc.fi/cloud/rahti/images/Using_Rahti_integrated_registry/)

## TL;DR

```sh
helm upgrade --install elastic-kibana .
```

## Explanations

This Helm Chart helps you to deploy Elasticsearch and Kibana on CSC Rahti (Openshift 4).  
If you want to use it with different values, you can edit `values.yaml` file and then run:  
```sh
helm upgrade --install elastic-kibana . -f {custom_values.yaml}
```

Kibana is automatically bundled in the Elasticsearch and deployed Helm Chart with the parameter `elasticsearch.global.kibanaEnabled=true`

We created a default `values.yaml` file that is compatible with our platform Rahti. This Helm Chart is using the official Helm Chart provided by bitnami.
Take a look:

- [Elasticsearch](https://github.com/bitnami/charts/tree/main/bitnami/elasticsearch)
- [Kibana](https://github.com/bitnami/charts/tree/main/bitnami/kibana)

Before applying the Helm Chart, you need to create two secrets named `elasticsearch-password` and `kibana-password`

You can generate them automatically by running this command:

```sh
oc create secret generic kibana-password --from-literal="kibana-password=$(python3 -c 'import secrets; print(secrets.token_hex(16))')" && oc create secret generic elasticsearch-password --from-literal="elasticsearch-password=$(python3 -c 'import secrets; print(secrets.token_hex(16))')"
```

### Elasticsearch rest Encryption

In `values.yaml`, when enabling elasticsearch' rest endpoint encryption you will also need to set `kibana.elasticsearch.security.tls.enabled` to the SAME value along with some additional values shown below for an "out of the box experience":

```yaml
elasticsearch:
  security:
    enabled: true
    exisingSecret: 'elasticsearch-password'
    tls:
      restEncryption: true
      # AutoGenerate TLS certs for elastic
      autoGenerated: true

  kibana:
    elasticsearch:
      security:
        auth:
          enabled: true
          existingSecret: 'kibana-password'
          createSystemUser: true
          elasticsearchPasswordSecret: 'elasticsearch-password'
        tls:
          # Instruct kibana to connect to elastic over https
          enabled: true
          # Bit of a catch 22, as you will need to know the name upfront of your release
          existingSecret: RELEASENAME-elasticsearch-coordinating-crt # or just 'elasticsearch-coordinating-crt' if the release name happens to be 'elasticsearch'
          # As the certs are auto-generated, they are pemCerts so set to true
          usePemCerts: true
```

**BE CAREFUL** in `elasticsearch.kibana.elasticsearch.security.tls` there is a parameter named `existingSecret` set to `RELEASENAME-elasticsearch-coordinating-crt`. **YOU MUST** change "RELEASENAME" by the name of the chart you will deploy.

For example, if you run the command `helm install kibana .`, "RELEASENAME" must be replaced by "kibana", so `kibana-elasticsearch-coordinating-crt`. On the other hand, if the release name happens to be "elasticsearch", "RELEASENAME" must be deleted, so, `elasticsearch-coordinating-crt`.

## Cleanup

To delete all the resources, simply uninstall the Helm Chart:

```sh
helm uninstall elastic-kibana
```